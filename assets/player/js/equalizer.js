(function(q,C){q.MVPAudioEqualizer=function(v){var k=this,r,b,e=v.canvas,d=e.getContext("2d"),w=v.holder,a,l,m,f,n,x,y,z,A,t,g,h,p,u=.7,B;this.resume=function(){alert(b.state);"suspended"===b.state&&"function"===typeof b.resume&&b.resume()};this.init=function(c){B?(a=b.createAnalyser(),p.connect(a),a.connect(b.destination),k.animate()):(b=new (q.AudioContext||q.webkitAudioContext),a=b.createAnalyser(),p=b.createMediaElementSource(c),p.connect(a),a.connect(b.destination),g=new Uint8Array(a.frequencyBinCount),
k.animate(),B=!0)};this.animate=function(){e.width=w.width();e.height=w.height();l=e.width/2;m=e.height/2;f=e.height/6;500<e.height?(n=200,u=.7):(n=100,u=.5);d.beginPath();d.arc(l,m,f,0,2*Math.PI);d.stroke();a.getByteFrequencyData(g);var c;for(c=0;c<n;c++)h=2*Math.PI/n,t=g[c]*u,x=l+Math.cos(h*c)*f,y=m+Math.sin(h*c)*f,z=l+Math.cos(h*c)*(f+t),A=m+Math.sin(h*c)*(f+t),d.strokeStyle="rgb("+g[c]+", "+g[c]+", 205)",d.lineWidth=2,d.beginPath(),d.moveTo(x,y),d.lineTo(z,A),d.stroke();r=requestAnimationFrame(k.animate)};
this.clean=function(){r&&cancelAnimationFrame(r);d&&d.clearRect(0,0,e.width,e.height);a&&(a.disconnect(),a=null)};this.changeSrc=function(){a=b.createAnalyser();p.connect(a);a.connect(b.destination);k.animate()}}})(window,jQuery);