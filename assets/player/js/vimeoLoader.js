(function(r,m){r.MVPVimeoLoader=function(t){function u(b){m.ajax({type:"GET",url:v+"includes/vimeo/vimeo_data.php",data:{type:"next_page",path:b,vai:w},dataType:"json"}).done(function(h){x(h)}).fail(function(h,l,a){console.log(h,l,a)})}function x(b){k=b.body.paging&&b.body.paging.next?b.body.paging.next:null;var h;var l=b.body.data?b.body.data.length:1;for(h=0;h<l&&f.length!=e;h++){var a=b.body.uri?b.body:b.body.data[h];var n=f,y=n.push,c=m.extend(!0,{},d);c.deeplink&&"vimeo_single"!=c.origtype&&
(c.deeplink+=(p+1).toString(),p++);c.type="vimeo";-1<a.uri.indexOf(":")&&(a.uri=a.uri.substr(0,a.uri.lastIndexOf(":")));c.path=a.uri.substr(a.uri.lastIndexOf("/")+1);a.duration&&(c.duration=a.duration);!c.title&&a.name&&(c.title=a.name);!c.description&&a.description&&(c.description=a.description);!c.thumb&&a.pictures&&(c.pictures=a.pictures);c.url||(c.url="https://vimeo.com/"+c.path);a.release_time&&(c.release_time=a.release_time);a.download&&a.download.link&&(c.download=a.download.link);a.user&&
a.user.account&&(c.userAccount=a.user.account);y.call(n,c)}f.length<e?k?(f.length+g>e&&(g=e-f.length,b=k.split("per_page=")[1].split("&")[0],k=k.replace("per_page="+b,"per_page="+g)),u(k)):m(q).trigger("MVPVimeoLoader.END_LOAD",{data:f,nextPageToken:k}):m(q).trigger("MVPVimeoLoader.END_LOAD",{data:f,nextPageToken:k})}var q=this,v=t.sourcePath,e,g=100,k,d=[],f=[],p,w=t.vai;this.resumeLoad=function(b){f=[];b?u(b):m(q).trigger("MVPVimeoLoader.END_LOAD",{data:f,nextPageToken:b})};this.setDataFromCache=
function(b){f=[];d=b;g=100;e=d.limit||1E3;e<g&&(g=e)};this.setData=function(b){if("file:"==r.location.protocol)console.log("Using Vimeo locally is not possible! This requires server connection!");else{f=[];d=b;g=100;e=d.limit||1E3;e<g&&(g=e);p=0;k=null;"vimeo_single"==d.type&&-1<d.path.indexOf("/")&&(d.path=d.path.replace("/",":"));var h=v+"includes/vimeo/vimeo_data.php";b={type:d.type,path:d.path,user_id:d.user_id,sort:d.sort,sortDirection:d.sortDirection,page:1,perPage:e<g?e:g,vai:w};m.ajax({type:"GET",
url:h,data:b,dataType:"json"}).done(function(l){if(!l.body)return console.log("Vimeo response null!"),!1;x(l)}).fail(function(l,a,n){console.log(l,a,n)})}};this.getNextPageToken=function(){return k}}})(window,jQuery);