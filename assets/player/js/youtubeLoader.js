(function(G,q){G.MVPYoutubeLoader=function(D){function H(a){q.ajax({url:a,dataType:"jsonp"}).done(function(b){k="https://www.googleapis.com/youtube/v3/playlistItems?part=contentDetails"+t+"&playlistId="+b.items[0].contentDetails.relatedPlaylists.uploads+"&fields=items(contentDetails(videoId)"+u+"),nextPageToken&maxResults="+l+"&key="+p;d="youtube_playlist";v(k)}).fail(function(b,c,f){console.log(b,c,f)})}function v(a){q.ajax({url:a,dataType:"jsonp"}).done(function(b){if(b.error&&b.error.message&&
(console.log(b.error.message),-1<b.error.message.indexOf("exceeded")&&-1<b.error.message.indexOf("quota"))){if(1<z.length&&(A++,A<z.length)){p=z[A];var c=a.substr(0,a.indexOf("&key=")+5);b=a.substr(a.indexOf("&part="));k=c=c+p+b;v(c)}return}var f,w=b.items.length;(g=b.nextPageToken)&&(g=k+"&pageToken="+g);for(f=0;f<w&&e.length!=n;f++){var m=b.items[f];if("youtube_playlist"==d||"youtube_single"==d||"youtube_single_list"==d||"youtube_channel"==d)m.status?"public"==m.status.privacyStatus&&e.push(E(m,
d)):m.snippet&&"Private video"!=m.snippet.title&&e.push(E(m,d))}if("youtube_single"==d||"youtube_single_list"==d)q(x).trigger("MVPYoutubeLoader.END_LOAD",{data:e,nextPageToken:g});else if(e.length<n)if(g){e.length+l>n&&(l=n-e.length,b=g.substr(0,k.indexOf("&maxResults=")+12),f=g.substr(k.indexOf("&key=")),g=b+l.toString()+f);if("youtube_playlist"==d||"youtube_channel"==d)c=g;v(c)}else-1<y.playlistItemContent.indexOf("duration")?(B=e.length,r=0,C()):q(x).trigger("MVPYoutubeLoader.END_LOAD",{data:e,
nextPageToken:g});else-1<y.playlistItemContent.indexOf("duration")?(B=e.length,r=0,C()):q(x).trigger("MVPYoutubeLoader.END_LOAD",{data:e,nextPageToken:g})}).fail(function(b,c,f){console.log(b,c,f)})}function C(){var a="",b,c=0;for(b=r;b<B&&(a+=e[b].path+",",c++,50!=c);b++);a=a.substr(0,a.length-1);q.ajax({url:"https://www.googleapis.com/youtube/v3/videos?id="+a+"&key="+p+"&part=liveStreamingDetails,contentDetails&fields=items(contentDetails(duration))",dataType:"jsonp"}).done(function(f){f.items.length!=
c&&console.log("getYtDuration response length mismatch!");var w=f.items.length;for(b=0;b<w;b++){var m=f.items[b];e[r].duration=F(m.contentDetails.duration);m.liveStreamingDetails&&(e[r].liveStream=!0,e[r].liveStreamingDetails=item.liveStreamingDetails);r++}r<B?C():q(x).trigger("MVPYoutubeLoader.END_LOAD",{data:e,nextPageToken:g})}).fail(function(f,w,m){console.log(f,w,m)})}function E(a,b){var c=jQuery.extend(!0,{},h);c.type="youtube";delete c.limit;"youtube_single"==b||"youtube_single_list"==b?c.path=
a.id:"youtube_playlist"==b?c.path=a.contentDetails.videoId:"youtube_channel"==b&&(c.path=a.id.videoId);a.snippet&&(!c.title&&a.snippet.title&&(c.title=a.snippet.title),!c.description&&a.snippet.description&&(c.description=a.snippet.description),a.snippet.publishedAt&&(c.date=a.snippet.publishedAt),!c.thumb&&a.snippet.thumbnails&&(c.thumbnails=a.snippet.thumbnails));a.liveStreamingDetails&&(c.liveStream=!0,c.liveStreamingDetails=a.liveStreamingDetails);a.contentDetails&&(a.contentDetails.projection&&
"360"==a.contentDetails.projection&&(c.is360=!0),!c.duration&&a.contentDetails.duration&&(c.duration=F(a.contentDetails.duration)));return c}function F(a){var b=a.match(/\d+/g);0<=a.indexOf("M")&&-1==a.indexOf("H")&&-1==a.indexOf("S")&&(b=[0,b[0],0]);0<=a.indexOf("H")&&-1==a.indexOf("M")&&(b=[b[0],0,b[1]]);0<=a.indexOf("H")&&-1==a.indexOf("M")&&-1==a.indexOf("S")&&(b=[b[0],0,0]);a=0;3==b.length&&(a+=3600*parseInt(b[0]),a+=60*parseInt(b[1]),a+=parseInt(b[2]));2==b.length&&(a+=60*parseInt(b[0]),a+=
parseInt(b[1]));1==b.length&&(a+=parseInt(b[0]));return a}var x=this,y=D,d,h,e=[],B,r,l=50,k,g,n,z=D.youtubeAppId.split(",").map(function(a){return a.trim()}),A=0,p=z[A],t,u;this.resumeLoad=function(a){e=[];a?(k=a.substr(0,a.lastIndexOf("&pageToken=")),v(a)):q(x).trigger("MVPYoutubeLoader.END_LOAD",{data:e,nextPageToken:a})};this.setDataFromCache=function(a){e=[];h=a;n=h.limit||400;l=50;n<l&&(l=n);d=h.type};this.setData=function(a){if(p){e=[];h=a;n=h.limit||400;l=50;n<l&&(l=n);d=h.type;g=null;a="title,description,";
-1<y.playlistItemContent.indexOf("date")&&(a+="publishedAt,");-1<y.playlistItemContent.indexOf("thumb")&&(a+="thumbnails(default(url),standard(url),medium(url),high(url),maxres(url)),");0<a.length?(a=a.substr(0,a.length-1),"youtube_single"==d||"youtube_single_list"==d?(t=",liveStreamingDetails,snippet",u=",liveStreamingDetails,snippet("+a+")"):(t=",snippet",u=",snippet("+a+")")):u=t="";if("youtube_single"==d||"youtube_single_list"==d)"youtube_single_list"==d&&(h.path=h.path.replace(/\s+/g,"")),k=
-1<y.playlistItemContent.indexOf("duration")?"https://www.googleapis.com/youtube/v3/videos?id="+h.path+"&key="+p+"&part=id"+t+",contentDetails&fields=items(id"+u+",contentDetails(duration))":"https://www.googleapis.com/youtube/v3/videos?id="+h.path+"&key="+p+"&part=id"+t+"&fields=items(id"+u+")";else if("youtube_playlist"==d)k="https://www.googleapis.com/youtube/v3/playlistItems?playlistId="+h.path+"&maxResults="+l+"&key="+p+"&part=contentDetails"+t+"&fields=items(contentDetails(videoId)"+u+"),nextPageToken";
else{"youtube_channel"==d?(k="https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id="+h.path+"&fields=items(contentDetails%2FrelatedPlaylists%2Fuploads)&key="+p,H(k)):console.log("Wrong youtube type!");return}v(k)}else alert("Youtube API key missing! Set Youtube API key in settings.")};this.getNextPageToken=function(){return g}}})(window,jQuery);